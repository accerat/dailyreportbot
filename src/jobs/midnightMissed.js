import cron from 'node-cron'; import { DateTime } from 'luxon'; import * as store from '../db/store.js'; cron.schedule('5 0 * * *', async()=>{ const now=DateTime.now().setZone('America/Chicago'); const day=now.minus({days:1}).toISODate(); const ps=await store.allSummaryProjects(); for(const p of ps){ const had=await store.hasReportOn(p.id, day); if(!had && !p.paused){ await store.addMissedDay(p.id, day); } } }, { timezone: 'America/Chicago' });
