import { SlashCommandBuilder } from 'discord.js'; import * as store from '../db/store.js'; export const data=new SlashCommandBuilder().setName('admin-backfill-missed').setDescription('[Admin] Insert a missed-report row for testing').addIntegerOption(o=>o.setName('project_id').setRequired(true).setDescription('Project ID')).addStringOption(o=>o.setName('ct_date').setDescription('YYYY-MM-DD; default=yesterday CT')); export async function execute(i){ if(!isAdmin(i)) return; await i.deferReply({flags:64}); const pid=i.options.getInteger('project_id', true); const dateStr=i.options.getString('ct_date'); const date=dateStr||new Date(Date.now()-86400000).toISOString().slice(0,10); await store.addMissedDay(pid,date); await i.editReply(`Missed-report recorded for project ${pid} on ${date}.`);} function isAdmin(i){ const allowed=(process.env.ADMIN_USER_IDS||'').split(',').filter(Boolean); if(allowed.includes(i.user.id)) return true; if(i.memberPermissions?.has('Administrator')) return true; i.reply({content:'Admins only.', flags:64}); return false; }
